(function(){$.TextboxList.Autocomplete=function(F,u){var l,z,f,r,E,d=[],n=[],w=[],k=false,v,h,B,e,q,i;var g=$.extend(true,{minLength:1,maxResults:10,insensitive:true,highlight:true,highlightSelector:null,mouseInteraction:true,onlyFromValues:false,queryRemote:false,remote:{url:"",param:"search",extraParams:{},loadPlaceholder:"Please wait..."},method:"standard",placeholder:"Type to receive suggestions"},u);var A=function(){F.addEvent("bitEditableAdd",D).addEvent("bitEditableFocus",o).addEvent("bitEditableBlur",p).setOptions({bitsOptions:{editable:{addKeys:false,stopEnter:false}}});if($.browser.msie){F.setOptions({bitsOptions:{editable:{addOnBlur:false}}})}z=F.getOptions().prefix+"-autocomplete";f=$.TextboxList.Autocomplete.Methods[g.method];r=$('<div class="'+z+'" />').width(F.getContainer().width()).appendTo(F.getContainer());if(b(g.placeholder)){k=$('<div class="'+z+'-placeholder" />').html(g.placeholder).appendTo(r)}E=$('<ul class="'+z+'-results" />').appendTo(r).click(function(I){I.stopPropagation();I.preventDefault()})};var D=function(I){I.toElement().keydown(C).keyup(function(){o()})};var o=function(K){if(K){h=K}if(!g.queryRemote&&!d.length){return}var I=$.trim(h.getValue()[1]);if(I.length<g.minLength){H()}if(I==q){return}q=I;E.css("display","none");if(I.length<g.minLength){return}if(g.queryRemote){if(n[I]){d=n[I]}else{var J=g.remote.extraParams;J[g.remote.param]=I;if(i){i.abort()}i=$.ajax({url:g.remote.url,data:J,dataType:"json",success:function(L){n[I]=L;d=L;t(I)}})}}t(I)};var t=function(J){var I=f.filter(d,J,g.insensitive,g.maxResults);if(F.getOptions().unique){I=$.grep(I,function(K){return F.isDuplicate(K)==-1})}m();if(!I.length){return}y();E.empty().css("display","block");$.each(I,function(K,L){c(L,J)});if(g.onlyFromValues){x()}I=I};var c=function(J,K){var I=$('<li class="'+z+'-result" />').html(J[3]?J[3]:J[1]).data("textboxlist:auto:value",J);I.appendTo(E);if(g.highlight){$(g.highlightSelector?I.find(g.highlightSelector):I).each(function(){if($(this).html()){f.highlight($(this),K,g.insensitive,z+"-highlight")}})}if(g.mouseInteraction){I.css("cursor","pointer").hover(function(){s(I)}).mousedown(function(L){L.stopPropagation();L.preventDefault();clearTimeout(B);e=true}).mouseup(function(){if(e){G();h.focus();o();e=false}});if(!g.onlyFromValues){I.mouseleave(function(){if(v&&(v.get(0)==I.get(0))){y()}})}}};var p=function(){B=setTimeout(function(){m();E.css("display","none");q=null},$.browser.msie?150:0)};var H=function(){if(k){k.css("display","block")}};var m=function(){if(k){k.css("display","none")}};var s=function(I){if(!I||!I.length){return}y();v=I.addClass(z+"-result-focus")};var y=function(){if(v&&v.length){v.removeClass(z+"-result-focus");v=null}};var x=function(){return s(E.find(":first"))};var j=function(I){if(!v||!v.length){return self}return s(v[I]())};var G=function(){var J=v.data("textboxlist:auto:value");var I=F.create("box",J.slice(0,3));if(I){I.autoValue=J;if($.isArray(l)){l.push(J)}h.setValue([null,"",null]);I.inject(h.toElement(),"before")}y();return self};var C=function(K){var J=function(){K.stopPropagation();K.preventDefault()};switch(K.which){case 38:J();(!g.onlyFromValues&&v&&v.get(0)===E.find(":first").get(0))?y():j("prev");break;case 40:J();(v&&v.length)?j("next"):x();break;case 13:J();if(v&&v.length){G()}else{if(!g.onlyFromValues){var L=h.getValue();var I=F.create("box",L);if(I){I.inject(h.toElement(),"before");h.setValue([null,"",null])}}}}};this.setValues=function(I){d=I};A()};$.TextboxList.Autocomplete.Methods={standard:{filter:function(e,g,d,c){var j=[],h=new RegExp(""+a(g),d?"i":"");for(var f=0;f<e.length;f++){if(j.length===c){break}if(h.test(e[f][1])){j.push(e[f])}}return j},highlight:function(f,e,d,c){var g=new RegExp("(<[^>]*>)|("+a(e)+")",d?"ig":"g");return f.html(f.html().replace(g,function(i,h,j){return(i.charAt(0)=="<")?i:'<strong class="'+c+'">'+j+"</strong>"}))}}};var b=function(c){return !!(c||c===0)};var a=function(c){return c.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")}})();
